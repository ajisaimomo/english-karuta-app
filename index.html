<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã¾ãªã³ã®çª“å£ ğŸ“šâœ¨</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'BIZ UDPã‚´ã‚·ãƒƒã‚¯', 'Yu Gothic UI', 'Meiryo UI', 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            animation: fadeIn 0.8s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        h1 {
            text-align: center;
            color: #5a67d8;
            font-size: 2.8em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            font-size: 1.2em;
            margin-bottom: 40px;
        }
        
        .section {
            margin-bottom: 40px;
            padding: 25px;
            border-radius: 15px;
            background: linear-gradient(145deg, #f8f9ff 0%, #e8f4f8 100%);
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        
        .section:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .section-title {
            font-size: 1.5em;
            color: #4a5568;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: stretch;
        }
        
        input[type="text"],         textarea {
            flex: 1;
            padding: 20px;
            font-size: 16px;
            line-height: 1.8;
            border: 2px solid #cbd5e0;
            border-radius: 10px;
            resize: vertical;
            transition: border-color 0.3s ease;
            font-family: inherit;
            min-height: 150px;
        }
        
        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        textarea {
            resize: vertical;
            min-height: 120px;
            line-height: 1.6;
        }
        
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn:disabled {
            background: #a0aec0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #48bb78, #38a169);
        }
        
        .btn-danger {
            background: linear-gradient(45deg, #fc8181, #f56565);
        }
        
        .btn-copy {
            background: linear-gradient(45deg, #ed8936, #dd6b20);
        }
        
        .btn-voice {
            background: linear-gradient(45deg, #9f7aea, #805ad5);
            min-width: 50px;
            justify-content: center;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .result-box {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin-top: 15px;
            min-height: 80px;
            font-size: 18px;
            line-height: 2;
            display: none;
        }
        
        .result-success {
            border-color: #68d391;
            background: linear-gradient(145deg, #f0fff4 0%, #c6f6d5 100%);
        }
        
        .result-error {
            border-color: #fc8181;
            background: linear-gradient(145deg, #fffafa 0%, #fed7d7 100%);
            color: #c53030;
        }
        
        .result-loading {
            border-color: #b794f6;
            background: linear-gradient(145deg, #faf5ff 0%, #e9d8fd 100%);
            color: #553c9a;
        }
        
        ruby rt {
            font-size: 14px;
            color: #666;
            font-weight: normal;
        }
        
        .stats {
            background: #edf2f7;
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 13px;
            font-family: 'Courier New', monospace;
        }
        
        .copy-success {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #48bb78;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            font-weight: bold;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            animation: copyNotification 4s ease-out;
        }
        
        @keyframes copyNotification {
            0% { opacity: 0; transform: translateX(100px); }
            10% { opacity: 1; transform: translateX(0); }
            90% { opacity: 1; transform: translateX(0); }
            100% { opacity: 0; transform: translateX(100px); }
        }
        
        @media (max-width: 768px) {
            .container { padding: 20px; margin: 10px; }
            h1 { font-size: 2.2em; }
            .input-group { flex-direction: column; }
            .btn { justify-content: center; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ã¾ãªã³ã®çª“å£ ğŸ“šâœ¨</h1>
        <p class="subtitle">Google<ruby>æ¤œç´¢<rt>ã‘ã‚“ã•ã</rt></ruby> + <ruby>è¾æ›¸<rt>ã˜ã—ã‚‡</rt></ruby> + ãƒ«ãƒ“<ruby>æŒ¯<rt>ãµ</rt></ruby>ã‚ŠãŒ1ã¤ã®ã‚µã‚¤ãƒˆã§<ruby>å®Œçµ<rt>ã‹ã‚“ã‘ã¤</rt></ruby></p>
        
        <!-- 1. Googleæ¤œç´¢ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="section">
            <h2 class="section-title">
                <span>ğŸ”</span>
                Googleæ¤œç´¢ï¼ˆéŸ³å£°å…¥åŠ›å¯¾å¿œï¼‰
            </h2>
            <div class="input-group">
                <input type="text" id="searchInput" placeholder="èª¿ã¹ãŸã„ã“ã¨ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šäººå·¥çŸ¥èƒ½ã€æ­´å²ã€ç§‘å­¦ãªã©ï¼‰">
                <button class="btn btn-voice" onclick="startVoiceSearch()" id="voiceBtn" title="éŸ³å£°å…¥åŠ›">
                    ğŸ¤
                </button>
                <button class="btn" onclick="googleSearch()">
                    <span>ğŸ”</span> æ¤œç´¢
                </button>
            </div>
            <p style="font-size: 14px; color: #666; margin-top: 10px;">
                ğŸ’¡ æ¤œç´¢çµæœã¯æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ãã¾ã™ã€‚çµæœã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ä¸‹ã®ã€Œãƒ«ãƒ“æŒ¯ã‚Šã€ã§ä½¿ãˆã¾ã™ã€‚
            </p>
        </div>
        
        <!-- 2. è¾æ›¸ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="section">
            <h2 class="section-title">
                <span>ğŸ“–</span>
                å˜èªã®æ„å‘³èª¿ã¹ï¼ˆ2ã¤ã®æ–¹æ³•ï¼‰
            </h2>
            <div class="input-group">
                <input type="text" id="dictInput" placeholder="æ„å‘³ã‚’çŸ¥ã‚ŠãŸã„å˜èªã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šäººå·¥çŸ¥èƒ½ã€åäºŒå˜ãªã©ï¼‰">
                <button class="btn" onclick="searchGakken()" title="å­¦ç ”ã‚­ãƒƒã‚ºè¾æ›¸ã§èª¿ã¹ã‚‹">
                    <span>ğŸ«</span> å­¦ç ”è¾æ›¸
                </button>
                <button class="btn btn-secondary" onclick="searchWithAI()" title="AIè¦ç´„ã§æ„å‘³ã‚’èª¿ã¹ã‚‹">
                    <span>ğŸ¤–</span> AIè¦ç´„
                </button>
                <button class="btn btn-danger" onclick="clearDict()">
                    <span>ğŸ—‘ï¸</span> æ¶ˆå»
                </button>
            </div>
            <div id="dictResult" class="result-box"></div>
            <p style="font-size: 14px; color: #666; margin-top: 10px;">
                ğŸ’¡ <strong>å­¦ç ”è¾æ›¸</strong>ï¼šå­ã©ã‚‚å‘ã‘è¾æ›¸ï¼ˆæ–°ã—ã„ã‚¿ãƒ–ã§é–‹ãã¾ã™ï¼‰<br>
                ğŸ’¡ <strong>AIè¦ç´„</strong>ï¼šGoogleæ¤œç´¢çµæœã‚’AIãŒè¦ç´„ã—ã¦ãƒ«ãƒ“ä»˜ãã§è¡¨ç¤º
            </p>
        </div>
        
        <!-- 3. ãƒ«ãƒ“æŒ¯ã‚Šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="section">
            <h2 class="section-title">
                <span>âœ¨</span>
                æ–‡ç« ã«ãƒ«ãƒ“æŒ¯ã‚Šï¼ˆWordè²¼ã‚Šä»˜ã‘å¯¾å¿œï¼‰
            </h2>
            <div class="input-group">
                <textarea id="rubyInput" rows="8" placeholder="ã“ã“ã«æ–‡ç« ã‚’ã‚³ãƒ”ãƒ¼ï¼†ãƒšãƒ¼ã‚¹ãƒˆã—ã¦ãã ã•ã„ã€‚Googleæ¤œç´¢ã®çµæœã€ãƒ‹ãƒ¥ãƒ¼ã‚¹è¨˜äº‹ã€æ•™ç§‘æ›¸ã®å†…å®¹ã€è«–æ–‡ã®ä¸€éƒ¨ãªã©ã€ã©ã‚“ãªæ–‡ç« ã§ã‚‚å¤§ä¸ˆå¤«ã§ã™ã€‚æœ€å¤§2000æ–‡å­—ã¾ã§å‡¦ç†ã§ãã¾ã™ã€‚" style="flex: 1; min-height: 200px; resize: vertical;"></textarea>
            </div>
            <div class="button-group" style="margin-top: 15px;">
                <button class="btn" onclick="addRuby()" id="rubyBtn">
                    <span>âœ¨</span> ãƒ«ãƒ“ã‚’ä»˜ã‘ã‚‹
                </button>
                <button class="btn btn-danger" onclick="clearRuby()">
                    <span>ğŸ—‘ï¸</span> æ¶ˆå»
                </button>
                <button class="btn btn-copy" onclick="copyResult()" id="copyBtn" style="display: none;">
                    <span>ğŸ“‹</span> çµæœã‚’ã‚³ãƒ”ãƒ¼
                </button>
            </div>
            <div id="rubyResult" class="result-box"></div>
        </div>
    </div>

    <script>
        let currentRubyResult = '';
        let currentDictResult = '';
        
        // 1. Googleæ¤œç´¢æ©Ÿèƒ½
        function googleSearch() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) {
                alert('æ¤œç´¢ã—ãŸã„å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            const searchUrl = `https://www.google.com/search?q=${encodeURIComponent(query)}`;
            window.open(searchUrl, '_blank');
            console.log(`ğŸ” Googleæ¤œç´¢: "${query}"`);
        }
        
        // éŸ³å£°å…¥åŠ›æ©Ÿèƒ½ï¼ˆã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–ç‰ˆï¼‰
        function startVoiceSearch() {
            // ãƒ–ãƒ©ã‚¦ã‚¶å¯¾å¿œãƒã‚§ãƒƒã‚¯
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                alert('âŒ ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°èªè­˜ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“\n\nå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶:\nãƒ»Google Chrome\nãƒ»Microsoft Edge\nãƒ»Safariï¼ˆä¸€éƒ¨ï¼‰');
                return;
            }
            
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognition = new SpeechRecognition();
            
            recognition.lang = 'ja-JP';
            recognition.continuous = false;
            recognition.interimResults = false;
            
            const voiceBtn = document.getElementById('voiceBtn');
            const searchInput = document.getElementById('searchInput');
            
            recognition.onstart = () => {
                voiceBtn.style.background = 'linear-gradient(45deg, #fc8181, #f56565)';
                voiceBtn.innerHTML = 'ğŸ”´';
                console.log('ğŸ¤ éŸ³å£°èªè­˜é–‹å§‹');
            };
            
            recognition.onresult = (event) => {
                const result = event.results[0][0].transcript;
                searchInput.value = result;
                console.log(`ğŸ¤ éŸ³å£°èªè­˜çµæœ: "${result}"`);
                
                // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed; top: 20px; right: 20px; z-index: 9999;
                    background: #48bb78; color: white; padding: 15px 20px;
                    border-radius: 10px; font-weight: bold;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                `;
                notification.textContent = `ğŸ¤ éŸ³å£°èªè­˜æˆåŠŸ: "${result}"`;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 3000);
            };
            
            recognition.onend = () => {
                voiceBtn.style.background = 'linear-gradient(45deg, #9f7aea, #805ad5)';
                voiceBtn.innerHTML = 'ğŸ¤';
                console.log('ğŸ¤ éŸ³å£°èªè­˜çµ‚äº†');
            };
            
            recognition.onerror = (event) => {
                console.error('éŸ³å£°èªè­˜ã‚¨ãƒ©ãƒ¼:', event.error);
                voiceBtn.style.background = 'linear-gradient(45deg, #9f7aea, #805ad5)';
                voiceBtn.innerHTML = 'ğŸ¤';
                
                let errorMessage = '';
                switch(event.error) {
                    case 'not-allowed':
                        errorMessage = `ğŸ¤ ãƒã‚¤ã‚¯ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸ

è§£æ±ºæ–¹æ³•:
1. ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼å·¦å´ã®ãƒã‚¤ã‚¯ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ã€Œè¨±å¯ã€ã‚’é¸æŠ
3. ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿

ã¾ãŸã¯:
â€¢ Chrome: è¨­å®š â†’ ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ â†’ ã‚µã‚¤ãƒˆè¨­å®š â†’ ãƒã‚¤ã‚¯
â€¢ Edge: è¨­å®š â†’ Cookieã¨ã‚µã‚¤ãƒˆæ¨©é™ â†’ ãƒã‚¤ã‚¯
ã§ã€ã“ã®ã‚µã‚¤ãƒˆã‚’è¨±å¯ã—ã¦ãã ã•ã„`;
                        break;
                    case 'no-speech':
                        errorMessage = 'ğŸ¤ éŸ³å£°ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚';
                        break;
                    case 'network':
                        errorMessage = 'ğŸ¤ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚';
                        break;
                    default:
                        errorMessage = `ğŸ¤ éŸ³å£°èªè­˜ã‚¨ãƒ©ãƒ¼: ${event.error}`;
                }
                
                alert(errorMessage);
            };
            
            try {
                recognition.start();
            } catch (error) {
                console.error('éŸ³å£°èªè­˜é–‹å§‹ã‚¨ãƒ©ãƒ¼:', error);
                alert('ğŸ¤ éŸ³å£°èªè­˜ã‚’é–‹å§‹ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ãŒãƒã‚¤ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚');
            }
        }
        
        // 2. è¾æ›¸æ©Ÿèƒ½
        // å­¦ç ”ã‚­ãƒƒã‚ºè¾æ›¸ã§æ¤œç´¢ï¼ˆä¿®æ­£ç‰ˆ - æ­£ã—ã„URLä½¿ç”¨ï¼‰
        function searchGakken() {
            const word = document.getElementById('dictInput').value.trim();
            if (!word) {
                alert('èª¿ã¹ãŸã„å˜èªã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            // HTMLã‹ã‚‰åˆ¤æ˜ã—ãŸæ­£ã—ã„æ¤œç´¢URL
            const gakkenUrl = `https://kids.gakken.co.jp/jiten/result/?s=${encodeURIComponent(word)}`;
            window.open(gakkenUrl, '_blank');
            
            // çµæœè¡¨ç¤º
            const resultDiv = document.getElementById('dictResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result-box result-success';
            resultDiv.innerHTML = `
                <div style="padding: 20px;">
                    <div style="font-size: 1.2em; margin-bottom: 15px; color: #2d3748;">
                        ğŸ« å­¦ç ”ã‚­ãƒƒã‚ºè¾æ›¸ã§ã€Œ${word}ã€ã‚’æ¤œç´¢ä¸­...
                    </div>
                    <div style="background: #e6fffa; padding: 15px; border-radius: 8px; border: 1px solid #4fd1c7;">
                        <strong>âœ… æ¤œç´¢ãŒé–‹å§‹ã•ã‚Œã¾ã—ãŸï¼</strong><br>
                        æ–°ã—ã„ã‚¿ãƒ–ã§å­¦ç ”ã‚­ãƒƒã‚ºè¾æ›¸ã®æ¤œç´¢çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚<br>
                        å­ã©ã‚‚å‘ã‘ã®åˆ†ã‹ã‚Šã‚„ã™ã„èª¬æ˜ãŒè¦‹ã¤ã‹ã‚Šã¾ã™ã€‚
                    </div>
                    <div style="margin-top: 15px; font-size: 14px; color: #666;">
                        ğŸ’¡ æ¤œç´¢çµæœãŒè¡¨ç¤ºã•ã‚Œãªã„å ´åˆã¯ã€æ¤œç´¢çª“ã«ã€Œ${word}ã€ã¨å†å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
                    </div>
                </div>
            `;
            
            console.log(`ğŸ« å­¦ç ”è¾æ›¸ã§æ­£ã—ã„æ¤œç´¢URLä½¿ç”¨: "${word}"`);
        }
        
        // AIè¦ç´„æ©Ÿèƒ½ï¼ˆã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–ç‰ˆï¼‰
        async function searchWithAI() {
            const word = document.getElementById('dictInput').value.trim();
            if (!word) {
                alert('èª¿ã¹ãŸã„å˜èªã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            const resultDiv = document.getElementById('dictResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result-box result-loading';
            resultDiv.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 1.5em; margin-bottom: 10px;">ğŸ¤–</div>
                    <div>ã€Œ${word}ã€ã®æ„å‘³ã‚’AIãŒè¦ç´„ã—ã¦ã„ã¾ã™...</div>
                    <div style="font-size: 14px; color: #666; margin-top: 5px;">
                        Googleæ¤œç´¢ã‚‚åŒæ™‚ã«é–‹ãã¾ã™
                    </div>
                </div>
            `;
            
            try {
                // Googleæ¤œç´¢ã§å˜èªã®ã¿æ¤œç´¢ï¼ˆAIã«ã‚ˆã‚‹æ¦‚è¦ãŒè¡¨ç¤ºã•ã‚Œã‚„ã™ã„ï¼‰
                const searchUrl = `https://www.google.com/search?q=${encodeURIComponent(word)}`;
                window.open(searchUrl, '_blank');
                
                // AIè¦ç´„ã‚’ç”Ÿæˆã—ã¦ãƒ«ãƒ“æŒ¯ã‚Šï¼ˆã‚µãƒ¼ãƒãƒ¼æ¥ç¶šç¢ºèªä»˜ãï¼‰
                const aiExplanation = generateDetailedAIExplanation(word);
                
                // ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šç¢ºèª
                let response;
                try {
                    response = await fetch('/api/ruby', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ text: aiExplanation })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼: ${response.status} ${response.statusText}`);
                    }
                } catch (fetchError) {
                    console.error('ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šã‚¨ãƒ©ãƒ¼:', fetchError);
                    
                    // ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šå¤±æ•—æ™‚ã¯ãƒ«ãƒ“ãªã—ã§è¡¨ç¤º
                    resultDiv.className = 'result-box result-success';
                    resultDiv.innerHTML = `
                        <div style="font-weight: bold; margin-bottom: 15px; color: #2d3748; font-size: 1.1em;">
                            ğŸ¤– ã€Œ${word}ã€ã®AIè¦ç´„èª¬æ˜
                        </div>
                        <div style="padding: 20px; background: #fff; border-radius: 10px; border: 2px solid #e2e8f0; line-height: 2.2;">
                            ${aiExplanation}
                        </div>
                        <div style="background: #fff3cd; padding: 12px; border-radius: 8px; margin-top: 15px; font-size: 14px; color: #856404;">
                            âš ï¸ <strong>ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šã‚¨ãƒ©ãƒ¼</strong><br>
                            ãƒ«ãƒ“æŒ¯ã‚Šæ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚<br>
                            <code>npm start</code> ã§ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¦ãã ã•ã„ã€‚
                        </div>
                        <div style="background: #e6fffa; padding: 12px; border-radius: 8px; margin-top: 10px; font-size: 14px;">
                            ğŸ’¡ <strong>Googleæ¤œç´¢ã®ã‚³ãƒ„ï¼š</strong><br>
                            ã€Œ${word}ã€ã§æ¤œç´¢ã™ã‚‹ã¨ã€Google AIã®ã€ŒAIã«ã‚ˆã‚‹æ¦‚è¦ã€ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚<br>
                            ä¸Šã®èª¬æ˜ã¨æ¯”è¼ƒã—ã¦ã€ã‚ˆã‚Šè©³ã—ã„æƒ…å ±ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
                        </div>
                    `;
                    
                    console.log(`ğŸ¤– AIè¾æ›¸æ¤œç´¢å®Œäº†ï¼ˆãƒ«ãƒ“ãªã—ç‰ˆ): "${word}"`);
                    return;
                }
                
                const data = await response.json();
                
                if (data.success) {
                    currentDictResult = aiExplanation;
                    
                    resultDiv.className = 'result-box result-success';
                    resultDiv.innerHTML = `
                        <div style="font-weight: bold; margin-bottom: 15px; color: #2d3748; font-size: 1.1em;">
                            ğŸ¤– ã€Œ${word}ã€ã®AIè¦ç´„èª¬æ˜ï¼ˆãƒ«ãƒ“ä»˜ãï¼‰
                        </div>
                        <div style="padding: 20px; background: #fff; border-radius: 10px; border: 2px solid #e2e8f0; line-height: 2.2;">
                            ${data.output}
                        </div>
                        <div style="background: #e1f5fe; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #03a9f4;">
                            <div style="font-weight: bold; color: #0277bd; margin-bottom: 8px; font-size: 16px;">
                                <ruby>ğŸ’¡<rt></rt></ruby> <ruby>ä½¿<rt>ã¤ã‹</rt></ruby>ã„<ruby>æ–¹<rt>ã‹ãŸ</ruby>ã‚¬ã‚¤ãƒ‰
                                <button onclick="speakGuide()" style="background: #4fc3f7; color: white; border: none; padding: 5px 10px; border-radius: 15px; margin-left: 10px; cursor: pointer; font-size: 12px;" title="ã‚¬ã‚¤ãƒ‰ã‚’èª­ã¿ä¸Šã’">
                                    ğŸ”Š <ruby>èª­<rt>ã‚ˆ</rt></ruby>ã¿<ruby>ä¸Š<rt>ã‚</rt></ruby>ã’
                                </button>
                            </div>
                            <div style="font-size: 14px; line-height: 1.8;">
                                <strong>ğŸ“– ã‚ˆã‚Š<ruby>è©³<rt>ãã‚</rt></ruby>ã—ã<ruby>èª¿<rt>ã—ã‚‰</rt></ruby>ã¹ã‚‹ã«ã¯ï¼š</strong><br>
                                â€¢ <ruby>æ–°<rt>ã‚ãŸã‚‰</rt></ruby>ã—ã„ã‚¿ãƒ–ã§Google<ruby>æ¤œç´¢<rt>ã‘ã‚“ã•ã</rt></ruby><ruby>çµæœ<rt>ã‘ã£ã‹</rt></ruby>ãŒ<ruby>é–‹<rt>ã²ã‚‰</rt></ruby>ã„ã¦ã„ã¾ã™<br>
                                â€¢ ã€ŒAIã«ã‚ˆã‚‹<ruby>æ¦‚è¦<rt>ãŒã„ã‚ˆã†</rt></ruby>ã€ã‚„<ruby>è©³ç´°<rt>ã—ã‚‡ã†ã•ã„</rt></ruby><ruby>æƒ…å ±<rt>ã˜ã‚‡ã†ã»ã†</rt></ruby>ã‚’ã”<ruby>ç¢ºèª<rt>ã‹ãã«ã‚“</rt></ruby>ãã ã•ã„<br><br>
                                
                                <strong>âœ¨ <ruby>é•·<rt>ãªãŒ</rt></ruby>ã„<ruby>æ–‡ç« <rt>ã¶ã‚“ã—ã‚‡ã†</rt></ruby>ã«ãƒ«ãƒ“ã‚’<ruby>æŒ¯<rt>ãµ</rt></ruby>ã‚‹ã«ã¯ï¼š</strong><br>
                                â€¢ Google<ruby>æ¤œç´¢<rt>ã‘ã‚“ã•ã</rt></ruby><ruby>çµæœ<rt>ã‘ã£ã‹</rt></ruby>ã®<ruby>æ–‡ç« <rt>ã¶ã‚“ã—ã‚‡ã†</rt></ruby>ã‚’ã‚³ãƒ”ãƒ¼<br>
                                â€¢ <ruby>ä¸‹<rt>ã—ãŸ</rt></ruby>ã®ã€Œãƒ«ãƒ“<ruby>æŒ¯<rt>ãµ</rt></ruby>ã‚Šã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«<ruby>è²¼<rt>ã¯</rt></ruby>ã‚Š<ruby>ä»˜<rt>ã¤</rt></ruby>ã‘<br>
                                â€¢ <ruby>æœ€å¤§<rt>ã•ã„ã ã„</rt></ruby>2000<ruby>æ–‡å­—<rt>ã‚‚ã˜</rt></ruby>ã¾ã§<ruby>å¯¾å¿œ<rt>ãŸã„ãŠã†</rt></ruby><br><br>
                                
                                <strong>ğŸ¯ ã‚³ãƒ„ï¼š</strong><br>
                                â€¢ <ruby>è¤‡æ•°<rt>ãµãã™ã†</rt></ruby>ã®<ruby>æƒ…å ±<rt>ã˜ã‚‡ã†ã»ã†</rt></ruby><ruby>æº<rt>ã’ã‚“</rt></ruby>ã§<ruby>ç¢ºèª<rt>ã‹ãã«ã‚“</rt></ruby>ã™ã‚‹ã¨<ruby>ç†è§£<rt>ã‚Šã‹ã„</rt></ruby>ãŒ<ruby>æ·±<rt>ãµã‹</rt></ruby>ã¾ã‚Šã¾ã™
                            </div>
                        </div>
                        <div class="stats">
                            ğŸ“Š ${data.stats.rubyCount}å€‹ã®ãƒ«ãƒ“ã‚’ä»˜ã‘ã¦èª­ã¿ã‚„ã™ãã—ã¾ã—ãŸ (${data.stats.processingTime}ms)
                        </div>
                    `;
                    
                    console.log(`ğŸ¤– AIè¾æ›¸æ¤œç´¢å®Œäº†: "${word}"`);
                } else {
                    throw new Error(data.error || 'AIè¾æ›¸æ©Ÿèƒ½ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
                }
                
            } catch (error) {
                console.error('AIè¾æ›¸ã‚¨ãƒ©ãƒ¼:', error);
                resultDiv.className = 'result-box result-error';
                resultDiv.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 1.5em; margin-bottom: 10px;">âŒ</div>
                        <div><strong>ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</strong></div>
                        <div style="margin: 15px 0; padding: 10px; background: #f8f9fa; border-radius: 5px; font-size: 14px;">
                            ${error.message}
                        </div>
                        <div style="margin-top: 15px; padding: 10px; background: #e6fffa; border-radius: 5px; font-size: 14px;">
                            ğŸ’¡ <strong>è§£æ±ºæ–¹æ³•:</strong><br>
                            1. ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª: <code>npm start</code><br>
                            2. ãƒ–ãƒ©ã‚¦ã‚¶ã‚’å†èª­ã¿è¾¼ã¿<br>
                            3. Googleæ¤œç´¢çµæœã‚’ã”ç¢ºèªãã ã•ã„
                        </div>
                    </div>
                `;
            }
        }
        
        // ã‚ˆã‚Šå…·ä½“çš„ãªAIèª¬æ˜ç”Ÿæˆ
        function generateDetailedAIExplanation(word) {
            const explanations = {
                'ã‚µã‚°ãƒ©ãƒ€ãƒ•ã‚¡ãƒŸãƒªã‚¢': 'ã‚µã‚°ãƒ©ãƒ€ãƒ•ã‚¡ãƒŸãƒªã‚¢ï¼ˆSagrada Familiaï¼‰ã¯ã€ã‚¹ãƒšã‚¤ãƒ³ã®ãƒãƒ«ã‚»ãƒ­ãƒŠã«ã‚ã‚‹ä¸–ç•Œçš„ã«æœ‰åãªæ•™ä¼šå»ºç¯‰ã§ã™ã€‚å»ºç¯‰å®¶ã‚¢ãƒ³ãƒˆãƒ‹ãƒ»ã‚¬ã‚¦ãƒ‡ã‚£ãŒè¨­è¨ˆã—ã€1882å¹´ã‹ã‚‰å»ºè¨­ãŒå§‹ã¾ã‚Šã¾ã—ãŸã€‚ç‹¬ç‰¹ãªå¤–è¦³ã¨è¤‡é›‘ãªè£…é£¾ã§çŸ¥ã‚‰ã‚Œã€ç¾åœ¨ã‚‚å»ºè¨­ãŒç¶šã„ã¦ã„ã¾ã™ã€‚å®Œæˆäºˆå®šã¯2026å¹´é ƒã¨ã•ã‚Œã¦ãŠã‚Šã€å®Œæˆã™ã‚Œã°ä¸–ç•Œã§æœ€ã‚‚å»ºè¨­æœŸé–“ã®é•·ã„å»ºç¯‰ç‰©ã®ä¸€ã¤ã¨ãªã‚Šã¾ã™ã€‚ãƒ¦ãƒã‚¹ã‚³ä¸–ç•Œéºç”£ã«ç™»éŒ²ã•ã‚Œã¦ãŠã‚Šã€å¹´é–“æ•°ç™¾ä¸‡äººã®è¦³å…‰å®¢ãŒè¨ªã‚Œã‚‹è¦³å…‰åæ‰€ã§ã™ã€‚',
                'ã‚¬ã‚¦ãƒ‡ã‚£': 'ã‚¢ãƒ³ãƒˆãƒ‹ãƒ»ã‚¬ã‚¦ãƒ‡ã‚£ï¼ˆ1852-1926ï¼‰ã¯ã€ã‚¹ãƒšã‚¤ãƒ³ãƒ»ã‚«ã‚¿ãƒ«ãƒ¼ãƒ‹ãƒ£å‡ºèº«ã®å»ºç¯‰å®¶ã§ã™ã€‚è‡ªç„¶ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒ”ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å¾—ãŸç‹¬å‰µçš„ãªå»ºç¯‰ã‚¹ã‚¿ã‚¤ãƒ«ã§çŸ¥ã‚‰ã‚Œã€æ›²ç·šã‚„æœ‰æ©Ÿçš„ãªå½¢ã‚’å¤šç”¨ã—ãŸä½œå“ã‚’æ•°å¤šãæ®‹ã—ã¾ã—ãŸã€‚ä»£è¡¨ä½œã«ã¯ã‚µã‚°ãƒ©ãƒ€ãƒ•ã‚¡ãƒŸãƒªã‚¢ã€ã‚°ã‚¨ãƒ«å…¬åœ’ã€ã‚«ã‚µãƒ»ãƒŸãƒ©ãªã©ãŒã‚ã‚Šã¾ã™ã€‚ãƒ¢ãƒ‡ãƒ«ãƒ‹ã‚¹ãƒ¢ï¼ˆã‚¢ãƒ¼ãƒ«ãƒ»ãƒŒãƒ¼ãƒ´ã‚©ãƒ¼ï¼‰ã®ä»£è¡¨çš„ãªå»ºç¯‰å®¶ã¨ã—ã¦ä¸–ç•Œçš„ã«è©•ä¾¡ã•ã‚Œã¦ã„ã¾ã™ã€‚',
                'ãƒãƒ«ã‚»ãƒ­ãƒŠ': 'ãƒãƒ«ã‚»ãƒ­ãƒŠã¯ã€ã‚¹ãƒšã‚¤ãƒ³åŒ—æ±éƒ¨ã‚«ã‚¿ãƒ«ãƒ¼ãƒ‹ãƒ£å·ã®å·éƒ½ã§ã€åŒå›½ç¬¬äºŒã®éƒ½å¸‚ã§ã™ã€‚åœ°ä¸­æµ·ã«é¢ã—ãŸæ¸¯æ¹¾éƒ½å¸‚ã§ã€ç¾ã—ã„æµ·å²¸ç·šã¨æ¸©æš–ãªæ°—å€™ã§çŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ã‚¬ã‚¦ãƒ‡ã‚£ã®å»ºç¯‰ç¾¤ã€ãƒ”ã‚«ã‚½ç¾è¡“é¤¨ã€ã‚µãƒƒã‚«ãƒ¼ãƒãƒ¼ãƒ FCãƒãƒ«ã‚»ãƒ­ãƒŠãªã©ã€èŠ¸è¡“ãƒ»æ–‡åŒ–ãƒ»ã‚¹ãƒãƒ¼ãƒ„ã®ä¸­å¿ƒåœ°ã¨ã—ã¦ä¸–ç•Œçš„ã«æœ‰åã§ã™ã€‚æ¯å¹´å¤šãã®è¦³å…‰å®¢ãŒè¨ªã‚Œã‚‹äººæ°—ã®è¦³å…‰éƒ½å¸‚ã§ã‚‚ã‚ã‚Šã¾ã™ã€‚',
                'åäºŒå˜': 'åäºŒå˜ï¼ˆã˜ã‚…ã†ã«ã²ã¨ãˆï¼‰ã¯ã€å¹³å®‰æ™‚ä»£ã®è²´æ—å¥³æ€§ãŒç€ç”¨ã—ãŸæ­£è£…ã§ã™ã€‚å®Ÿéš›ã«ã¯åäºŒæšã§ã¯ãªãã€è¤‡æ•°ã®ç€ç‰©ã‚’é‡ã­ã¦ç€ã‚‹ã“ã¨ã‹ã‚‰ã“ã®åå‰ãŒä»˜ãã¾ã—ãŸã€‚å˜ï¼ˆã²ã¨ãˆï¼‰ã¨ã„ã†ä¸‹ç€ã®ä¸Šã«ã€è¢¿ï¼ˆã†ã¡ãï¼‰ã¨å‘¼ã°ã‚Œã‚‹ç€ç‰©ã‚’ä½•æšã‚‚é‡ã­ã€æœ€å¾Œã«å”è¡£ï¼ˆã‹ã‚‰ãã¬ï¼‰ã¨è£³ï¼ˆã‚‚ï¼‰ã‚’ç€ç”¨ã—ã¾ã™ã€‚è‰²ã®çµ„ã¿åˆã‚ã›ã¯ã€Œè¥²è‰²ç›®ï¼ˆã‹ã•ã­ã®ã„ã‚ã‚ï¼‰ã€ã¨å‘¼ã°ã‚Œã€å­£ç¯€ã‚„èº«åˆ†ã«ã‚ˆã£ã¦æ±ºã‚ã‚‰ã‚Œã¦ã„ã¾ã—ãŸã€‚ç¾åœ¨ã§ã‚‚çš‡å®¤ã®é‡è¦ãªå„€å¼ã§ç€ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚',
                'äººå·¥çŸ¥èƒ½': 'äººå·¥çŸ¥èƒ½ï¼ˆã˜ã‚“ã“ã†ã¡ã®ã†ï¼‰ã¯ã€ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãŒäººé–“ã®çŸ¥èƒ½ã‚’æ¨¡å€£ã—ã¦å­¦ç¿’ã‚„æ¨è«–ã€åˆ¤æ–­ã‚’è¡Œã†æŠ€è¡“ã§ã™ã€‚è‹±èªã§ã¯Artificial Intelligenceã€ç•¥ã—ã¦AIã¨å‘¼ã°ã‚Œã¾ã™ã€‚æ©Ÿæ¢°å­¦ç¿’ã‚„æ·±å±¤å­¦ç¿’ã¨ã„ã£ãŸæ‰‹æ³•ã‚’ä½¿ã£ã¦ã€å¤§é‡ã®ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰è¦å‰‡æ€§ã‚„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¦‹ã¤ã‘å‡ºã—ã€äºˆæ¸¬ã‚„åˆ†é¡ã‚’è‡ªå‹•ã§è¡Œã„ã¾ã™ã€‚ç”»åƒèªè­˜ã€éŸ³å£°èªè­˜ã€è‡ªç„¶è¨€èªå‡¦ç†ã€è‡ªå‹•é‹è»¢ãªã©ã€ç¾ä»£ç¤¾ä¼šã®æ§˜ã€…ãªåˆ†é‡ã§æ´»ç”¨ã•ã‚Œã¦ãŠã‚Šã€ç§ãŸã¡ã®ç”Ÿæ´»ã‚’ä¾¿åˆ©ã«ã™ã‚‹é‡è¦ãªæŠ€è¡“ã§ã™ã€‚',
                'é‡å­ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿': 'é‡å­ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã¯ã€é‡å­åŠ›å­¦ã®åŸç†ã‚’åˆ©ç”¨ã—ãŸé©æ–°çš„ãªã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã§ã™ã€‚å¾“æ¥ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãŒ0ã¨1ã®äºŒé€²æ³•ã§è¨ˆç®—ã™ã‚‹ã®ã«å¯¾ã—ã€é‡å­ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã¯é‡å­ãƒ“ãƒƒãƒˆï¼ˆã‚­ãƒ¥ãƒ¼ãƒ“ãƒƒãƒˆï¼‰ã‚’ä½¿ç”¨ã—ã€0ã¨1ã®çŠ¶æ…‹ã‚’åŒæ™‚ã«è¡¨ç¾ã§ãã¾ã™ã€‚ã“ã®ã€Œé‡ã­åˆã‚ã›ã€ã¨ã€Œã‚‚ã¤ã‚Œã€ã¨ã„ã†é‡å­ç¾è±¡ã«ã‚ˆã‚Šã€ç‰¹å®šã®å•é¡Œã«å¯¾ã—ã¦å¾“æ¥ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã§ã¯ä¸å¯èƒ½ãªé«˜é€Ÿè¨ˆç®—ãŒå®Ÿç¾å¯èƒ½ã§ã™ã€‚æš—å·è§£èª­ã€è–¬ç‰©é–‹ç™ºã€é‡‘èè¨ˆç®—ã€æ°—è±¡äºˆæ¸¬ãªã©ã®åˆ†é‡ã§ã®å¿œç”¨ãŒæœŸå¾…ã•ã‚Œã¦ãŠã‚Šã€æœªæ¥ã®æƒ…å ±å‡¦ç†æŠ€è¡“ã¨ã—ã¦æ³¨ç›®ã•ã‚Œã¦ã„ã¾ã™ã€‚',
                'å…‰åˆæˆ': 'å…‰åˆæˆï¼ˆã“ã†ã”ã†ã›ã„ï¼‰ã¯ã€æ¤ç‰©ãŒå¤ªé™½ã®å…‰ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’ä½¿ã£ã¦äºŒé…¸åŒ–ç‚­ç´ ã¨æ°´ã‹ã‚‰ç³–åˆ†ã‚’ä½œã‚Šå‡ºã™ç”Ÿå‘½ç¾è±¡ã§ã™ã€‚ã“ã®éç¨‹ã§é…¸ç´ ã‚‚åŒæ™‚ã«ç”Ÿæˆã•ã‚Œã€åœ°çƒä¸Šã®ã™ã¹ã¦ã®ç”Ÿç‰©ã®ç”Ÿå­˜ã«å¿…è¦ä¸å¯æ¬ ã§ã™ã€‚æ¤ç‰©ã®è‘‰ã«ã‚ã‚‹è‘‰ç·‘ä½“ã¨ã„ã†å°ã•ãªå™¨å®˜ã§è¡Œã‚ã‚Œã€ã‚¯ãƒ­ãƒ­ãƒ•ã‚£ãƒ«ã¨ã„ã†ç·‘è‰²ã®è‰²ç´ ãŒå…‰ã‚’å¸åã—ã¾ã™ã€‚å…‰åˆæˆã«ã‚ˆã‚Šä½œã‚‰ã‚ŒãŸç³–åˆ†ã¯æ¤ç‰©ã®æˆé•·ã«ä½¿ã‚ã‚Œã€ã¾ãŸé£Ÿç‰©é€£é–ã‚’é€šã˜ã¦å‹•ç‰©ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼æºã«ã‚‚ãªã‚Šã¾ã™ã€‚åœ°çƒã®é…¸ç´ æ¿ƒåº¦ã®ç¶­æŒã‚„äºŒé…¸åŒ–ç‚­ç´ ã®å‰Šæ¸›ã«ã‚‚é‡è¦ãªå½¹å‰²ã‚’æœãŸã—ã¦ã„ã¾ã™ã€‚',
                'æ°‘ä¸»ä¸»ç¾©': 'æ°‘ä¸»ä¸»ç¾©ï¼ˆã¿ã‚“ã—ã‚…ã—ã‚…ãï¼‰ã¯ã€å›½æ°‘ãŒæ”¿æ²»ã®æ±ºå®šæ¨©ã‚’æŒã¤æ”¿æ²»åˆ¶åº¦ã§ã™ã€‚Democracyï¼ˆãƒ‡ãƒ¢ã‚¯ãƒ©ã‚·ãƒ¼ï¼‰ã®æ—¥æœ¬èªè¨³ã§ã€ã€Œæ°‘è¡†ã«ã‚ˆã‚‹æ”¯é…ã€ã¨ã„ã†æ„å‘³ãŒã‚ã‚Šã¾ã™ã€‚å›½æ°‘ãŒé¸æŒ™ã‚’é€šã˜ã¦ä»£è¡¨è€…ã‚’é¸ã³ã€ãã®ä»£è¡¨è€…ãŒå›½æ°‘ã®æ„è¦‹ã‚’æ”¿æ²»ã«åæ˜ ã•ã›ã‚‹é–“æ¥æ°‘ä¸»åˆ¶ãŒä¸€èˆ¬çš„ã§ã™ã€‚å¤šæ•°æ±ºã®åŸç†ã«åŸºã¥ããªãŒã‚‰ã‚‚ã€å°‘æ•°æ´¾ã®æ¨©åˆ©ã‚„æ„è¦‹ã‚‚å°Šé‡ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚è¨€è«–ã®è‡ªç”±ã€é›†ä¼šã®è‡ªç”±ã€å ±é“ã®è‡ªç”±ãªã©ã®åŸºæœ¬çš„äººæ¨©ãŒä¿éšœã•ã‚Œã€æ¨©åŠ›ã®åˆ†ç«‹ã«ã‚ˆã‚Šç‹¬è£ã‚’é˜²ãã¾ã™ã€‚ç¾ä»£ã®å¤šãã®å›½ã§æ¡ç”¨ã•ã‚Œã¦ã„ã‚‹æ”¿æ²»ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚',
                'ç¹”ç”°ä¿¡é•·': 'ç¹”ç”°ä¿¡é•·ï¼ˆãŠã ã®ã¶ãªãŒï¼‰ã¯ã€æˆ¦å›½æ™‚ä»£ã‚’ä»£è¡¨ã™ã‚‹æ­¦å°†ã§ã€å¤©ä¸‹çµ±ä¸€ã®åŸºç¤ã‚’ç¯‰ã„ãŸäººç‰©ã§ã™ã€‚1534å¹´ã«å°¾å¼µå›½ï¼ˆç¾åœ¨ã®æ„›çŸ¥çœŒï¼‰ã§ç”Ÿã¾ã‚Œã€ã€Œå¤©ä¸‹å¸ƒæ­¦ã€ã‚’ã‚¹ãƒ­ãƒ¼ã‚¬ãƒ³ã«å…¨å›½çµ±ä¸€ã‚’ç›®æŒ‡ã—ã¾ã—ãŸã€‚æ¡¶ç‹­é–“ã®æˆ¦ã„ã§ä»Šå·ç¾©å…ƒã‚’ç ´ã‚Šã€ãã®å¾Œã‚‚é©æ–°çš„ãªæˆ¦è¡“ã¨æ”¿ç­–ã§å‹¢åŠ›ã‚’æ‹¡å¤§ã—ã¾ã—ãŸã€‚æ¥½å¸‚æ¥½åº§ã«ã‚ˆã‚‹çµŒæ¸ˆæ”¿ç­–ã€é‰„ç ²ã®ç©æ¥µçš„æ´»ç”¨ã€çŸ³å±±æœ¬é¡˜å¯ºã¨ã®å¯¾ç«‹ãªã©ã€å¾“æ¥ã®å¸¸è­˜ã«ã¨ã‚‰ã‚ã‚Œãªã„è¡Œå‹•ã§çŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚1582å¹´ã«æœ¬èƒ½å¯ºã®å¤‰ã§æ˜æ™ºå…‰ç§€ã«è¥²ã‚ã‚Œã€49æ­³ã§æ­»å»ã—ã¾ã—ãŸã€‚è±Šè‡£ç§€å‰ã€å¾³å·å®¶åº·ã¸ã¨ç¶šãå¤©ä¸‹çµ±ä¸€ã®é“ç­‹ã‚’ä½œã£ãŸé‡è¦ãªæ­´å²äººç‰©ã§ã™ã€‚'
            };
            
            return explanations[word] || `ã€Œ${word}ã€ã«ã¤ã„ã¦ã€ã‚ˆã‚Šè©³ã—ã„æƒ…å ±ã¯Googleæ¤œç´¢çµæœã‚’ã”ç¢ºèªãã ã•ã„ã€‚æ–°ã—ã„ã‚¿ãƒ–ã§æ¤œç´¢çµæœãŒé–‹ã„ã¦ã„ã¾ã™ã€‚ãã“ã«è¡¨ç¤ºã•ã‚Œã‚‹æƒ…å ±ã®ä¸­ã§ã€é›£ã—ã„æ–‡ç« ãŒã‚ã‚Œã°ã€ã‚³ãƒ”ãƒ¼ã—ã¦ä¸‹ã®ã€Œãƒ«ãƒ“æŒ¯ã‚Šã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è²¼ã‚Šä»˜ã‘ã‚‹ã“ã¨ã§ã€èª­ã¿ã‚„ã™ãã§ãã¾ã™ã€‚ä¸€åº¦ã«æœ€å¤§1000æ–‡å­—ã¾ã§å‡¦ç†ã§ãã¾ã™ã€‚è¤‡æ•°ã®æƒ…å ±æºã‚’æ¯”è¼ƒã™ã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šæ­£ç¢ºã§è©³ã—ã„çŸ¥è­˜ã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚`;
        }
        
        // è¾æ›¸ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ¶ˆå»
        function clearDict() {
            document.getElementById('dictInput').value = '';
            document.getElementById('dictResult').style.display = 'none';
            currentDictResult = '';
            console.log('ğŸ—‘ï¸ è¾æ›¸ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ¶ˆå»');
        }
        
        // 3. ãƒ«ãƒ“æŒ¯ã‚Šæ©Ÿèƒ½ï¼ˆã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–ç‰ˆï¼‰
        async function addRuby() {
            const text = document.getElementById('rubyInput').value.trim();
            if (!text) {
                alert('ãƒ«ãƒ“ã‚’æŒ¯ã‚ŠãŸã„æ–‡ç« ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            if (text.length > 2000) {
                alert('æ–‡ç« ãŒé•·ã™ãã¾ã™ã€‚2000æ–‡å­—ä»¥å†…ã«ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            const resultDiv = document.getElementById('rubyResult');
            const rubyBtn = document.getElementById('rubyBtn');
            const copyBtn = document.getElementById('copyBtn');
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result-box result-loading';
            resultDiv.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 1.5em; margin-bottom: 10px;">âš¡</div>
                    <div>kuromoji.js ã§ãƒ«ãƒ“ã‚’æŒ¯ã£ã¦ã„ã¾ã™...</div>
                    <div style="font-size: 14px; color: #666; margin-top: 5px;">
                        ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šã‚’ç¢ºèªä¸­...
                    </div>
                </div>
            `;
            rubyBtn.disabled = true;
            copyBtn.style.display = 'none';
            
            try {
                // ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šç¢ºèª
                let response;
                try {
                    response = await fetch('/api/ruby', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ text: text })
                    });
                } catch (fetchError) {
                    console.error('ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šã‚¨ãƒ©ãƒ¼:', fetchError);
                    throw new Error(`ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“ã€‚ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚

è§£æ±ºæ–¹æ³•:
1. terminalã§ 'npm start' ã‚’å®Ÿè¡Œ
2. ã‚µãƒ¼ãƒãƒ¼ãŒ http://localhost:3000 ã§èµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
3. ãƒ–ãƒ©ã‚¦ã‚¶ã‚’å†èª­ã¿è¾¼ã¿

ã‚¨ãƒ©ãƒ¼è©³ç´°: ${fetchError.message}`);
                }
                
                if (!response.ok) {
                    const errorText = await response.text().catch(() => 'ãƒ¬ã‚¹ãƒãƒ³ã‚¹å–å¾—å¤±æ•—');
                    throw new Error(`ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼: ${response.status} ${response.statusText}\nè©³ç´°: ${errorText}`);
                }
                
                let data;
                try {
                    data = await response.json();
                } catch (jsonError) {
                    throw new Error('ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®å¿œç­”ãŒä¸æ­£ã§ã™ã€‚JSONè§£æã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
                }
                
                if (data.success) {
                    currentRubyResult = data.output;
                    
                    resultDiv.className = 'result-box result-success';
                    resultDiv.innerHTML = `
                        <div style="font-weight: bold; margin-bottom: 15px; color: #2d3748;">
                            âœ¨ ãƒ«ãƒ“æŒ¯ã‚Šå®Œäº†ï¼
                        </div>
                        <div style="padding: 20px; background: #fff; border-radius: 10px; border: 2px solid #e2e8f0; line-height: 2.2;">
                            ${data.output}
                        </div>
                        <div class="stats">
                            ğŸ“Š ${data.stats.inputLength}æ–‡å­— â†’ ${data.stats.tokens}ãƒˆãƒ¼ã‚¯ãƒ³ â†’ ${data.stats.rubyCount}å€‹ã®ãƒ«ãƒ“ã‚’ä»˜ä¸ (${data.stats.processingTime}ms)
                        </div>
                    `;
                    
                    copyBtn.style.display = 'flex';
                    console.log(`âœ¨ ãƒ«ãƒ“æŒ¯ã‚Šå®Œäº†: ${data.stats.tokens}ãƒˆãƒ¼ã‚¯ãƒ³`);
                } else {
                    throw new Error(data.error || 'ãƒ«ãƒ“æŒ¯ã‚Šå‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
                }
                
            } catch (error) {
                console.error('ãƒ«ãƒ“æŒ¯ã‚Šã‚¨ãƒ©ãƒ¼:', error);
                resultDiv.className = 'result-box result-error';
                resultDiv.innerHTML = `
                    <div style="padding: 20px;">
                        <div style="font-size: 1.2em; margin-bottom: 15px; color: #c53030;">
                            âŒ ãƒ«ãƒ“æŒ¯ã‚Šã‚¨ãƒ©ãƒ¼
                        </div>
                        <div style="background: #fed7d7; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <strong>ã‚¨ãƒ©ãƒ¼å†…å®¹:</strong><br>
                            ${error.message}
                        </div>
                        <div style="background: #e6fffa; padding: 15px; border-radius: 8px;">
                            <strong>ğŸ’¡ è§£æ±ºæ–¹æ³•:</strong><br>
                            1. ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ <code>npm start</code> ã‚’å®Ÿè¡Œ<br>
                            2. ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ãŸã‚‰ãƒ–ãƒ©ã‚¦ã‚¶ã‚’å†èª­ã¿è¾¼ã¿<br>
                            3. ã“ã®ç”»é¢ã§ã€Œãƒ«ãƒ“ã‚’ä»˜ã‘ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’å†åº¦æŠ¼ã™
                        </div>
                    </div>
                `;
            } finally {
                rubyBtn.disabled = false;
            }
        }
        
        // ãƒ«ãƒ“ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ¶ˆå»
        function clearRuby() {
            document.getElementById('rubyInput').value = '';
            document.getElementById('rubyResult').style.display = 'none';
            document.getElementById('copyBtn').style.display = 'none';
            currentRubyResult = '';
            console.log('ğŸ—‘ï¸ ãƒ«ãƒ“ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ¶ˆå»');
        }
        
        // çµæœã‚’ã‚³ãƒ”ãƒ¼ï¼ˆWordè²¼ã‚Šä»˜ã‘å¯¾å¿œãƒ»ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºèª¿æ•´ç‰ˆï¼‰
        function copyResult() {
            if (!currentRubyResult) {
                alert('ã‚³ãƒ”ãƒ¼ã™ã‚‹çµæœãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            try {
                // Wordç”¨ã«æœ€é©åŒ–ã•ã‚ŒãŸHTMLã‚’ç”Ÿæˆï¼ˆUDãƒ•ã‚©ãƒ³ãƒˆ + æ–‡å­—16pxã€ãƒ«ãƒ“8pxï¼‰
                const optimizedHTML = `
                    <div style="font-family: 'BIZ UDPã‚´ã‚·ãƒƒã‚¯', 'Yu Gothic UI', 'Meiryo UI', 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', sans-serif; font-size: 16px; line-height: 2.2;">
                        ${currentRubyResult.replace(/<ruby>/g, '<ruby style="font-size: 16px;">').replace(/<rt>/g, '<rt style="font-size: 8px; color: #666;">')}
                    </div>
                `;
                
                // ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç‰ˆï¼ˆãƒ«ãƒ“ãªã—ï¼‰
                const plainText = currentRubyResult.replace(/<[^>]*>/g, '');
                
                // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰APIã‚’ä½¿ç”¨ï¼ˆHTMLã¨ãƒ†ã‚­ã‚¹ãƒˆä¸¡æ–¹ã‚’ã‚³ãƒ”ãƒ¼ï¼‰
                if (navigator.clipboard && navigator.clipboard.write) {
                    const clipboardItem = new ClipboardItem({
                        'text/html': new Blob([optimizedHTML], { type: 'text/html' }),
                        'text/plain': new Blob([plainText], { type: 'text/plain' })
                    });
                    
                    navigator.clipboard.write([clipboardItem]).then(() => {
                        showCopySuccess('Wordæœ€é©åŒ–ç‰ˆ');
                        console.log('ğŸ“‹ Wordæœ€é©åŒ–HTML + ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼å®Œäº†');
                    }).catch(err => {
                        console.log('HTML+ãƒ†ã‚­ã‚¹ãƒˆã‚³ãƒ”ãƒ¼å¤±æ•—ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè¡Œ');
                        fallbackCopy();
                    });
                } else {
                    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ãƒ†ã‚­ã‚¹ãƒˆã®ã¿ã‚³ãƒ”ãƒ¼
                    fallbackCopy();
                }
                
            } catch (error) {
                console.error('ã‚³ãƒ”ãƒ¼ã‚¨ãƒ©ãƒ¼:', error);
                alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }
        
        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ãƒ†ã‚­ã‚¹ãƒˆã®ã¿ã‚³ãƒ”ãƒ¼
        function fallbackCopy() {
            const textArea = document.createElement('textarea');
            textArea.value = currentRubyResult.replace(/<[^>]*>/g, ''); // HTMLã‚¿ã‚°ã‚’é™¤å»
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            showCopySuccess('ãƒ†ã‚­ã‚¹ãƒˆç‰ˆ');
            console.log('ğŸ“‹ ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼å®Œäº†ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰');
        }
        
        // ã‚³ãƒ”ãƒ¼æˆåŠŸé€šçŸ¥ï¼ˆè©³ç´°ç‰ˆï¼‰
        function showCopySuccess(type) {
            const notification = document.createElement('div');
            notification.className = 'copy-success';
            notification.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 5px;">ğŸ“‹ ã‚³ãƒ”ãƒ¼å®Œäº†ï¼</div>
                <div style="font-size: 13px;">
                    ${type}ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ<br>
                    Wordã«è²¼ã‚Šä»˜ã‘ã‚‹ã¨æ–‡å­—16pxã€ãƒ«ãƒ“8pxã§è¡¨ç¤ºã•ã‚Œã¾ã™
                </div>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                }
            }, 4000);
        }
        
        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch (e.key) {
                    case 'Enter':
                        if (document.activeElement.id === 'searchInput') {
                            e.preventDefault();
                            googleSearch();
                        } else if (document.activeElement.id === 'dictInput') {
                            e.preventDefault();
                            searchWordMeaning();
                        } else if (document.activeElement.id === 'rubyInput') {
                            e.preventDefault();
                            addRuby();
                        }
                        break;
                    case 'c':
                        if (currentRubyResult && document.activeElement.id === 'rubyInput') {
                            e.preventDefault();
                            copyResult();
                        }
                        break;
                }
            }
        });
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†æ™‚
        window.addEventListener('load', () => {
            console.log('ğŸ“š ã¾ãªã³ã®çª“å£ - æº–å‚™å®Œäº†ï¼');
            console.log('âŒ¨ï¸  ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ: Ctrl+Enter=å®Ÿè¡Œ, Ctrl+C=ã‚³ãƒ”ãƒ¼');
            
            // æœ€åˆã®å…¥åŠ›æ¬„ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
            document.getElementById('searchInput').focus();
        });
    </script>
</body>
</html>
